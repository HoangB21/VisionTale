# AI Factory 前端项目

## 一、功能概述

本项目是 AI Factory 的前端部分，采用 Vue 3 + TypeScript + Vite 技术栈构建。项目使用 Element Plus 作为 UI 组件库，实现了一个现代化、响应式的用户界面。主要功能包括多语言支持、主题切换、路由管理等基础设施，为后续的业务功能开发提供了良好的基础。

## 二、项目结构及功能规划

### 项目分层结构

项目采用组件化的架构设计，主要包括以下几个层次：

1. **布局组件（layouts）**：负责整体页面布局，包括顶部导航栏、侧边栏等。
2. **业务组件（components）**：封装具体的业务逻辑组件，如项目管理、章节编辑等。
3. **公共组件（common）**：提供一些通用的组件，如对话框、表单等。
4. **工具类（utils）**：提供一些通用的工具方法和 API 封装。

### 项目文件结构

```

client/                 # 前端项目根目录
├── src/               # 源代码目录
│   ├── api/          # API 接口目录
│   │   ├── project_api.ts # 项目相关 API
│   │   ├── chapter_api.ts # 章节相关 API
│   │   ├── entity_api.ts # 实体相关 API
│   │   ├── media_api.ts # 媒体生成相关 API
│   │   └── request.ts # 请求封装，支持普通请求（Axios）和流式请求（Fetch API）处理
│   ├── components/    # 组件目录
│   │   ├── Header.vue # 顶部导航组件
│   │   └── ...       # 其他组件
│   ├── locales/      # 国际化文件目录
│   │   ├── en-US.ts  # 英文语言包
│   │   ├── zh-CN.ts  # 中文语言包
│   │   └── index.ts  # 国际化配置
│   ├── router/       # 路由配置目录
│   │   └── index.ts  # 路由配置文件
│   ├── store/        # 状态管理目录
│   ├── styles/       # 样式文件目录
│   ├── utils/        # 工具类目录
│   ├── views/        # 页面视图目录
│   │   ├── Project/  # 项目管理页面
│   │   │   └── index.vue
│   │   ├── ProjectMain/ # 项目详情页面
│   │   │   ├── index.vue # 项目主页面
│   │   │   ├── CharacterLibrary/ # 角色库管理
│   │   │   │   └── index.vue
│   │   │   ├── SceneLibrary/ # 场景库管理
│   │   │   │   └── index.vue
│   │   │   ├── StoryboardProcess/ # 分镜流程管理
│   │   │   │   └── index.vue
│   │   │   ├── TextCreation/ # 文本创作管理
│   │   │   │   └── index.vue
│   │   │   └── VideoOutput/ # 视频输出管理
│   │   │       └── index.vue
│   │   └── Setting/ # 设置页面
│   │       └── index.vue
│   │   └── NotFound/ # 404页面
│   │       └── index.vue
│   ├── App.vue       # 根组件
│   ├── main.ts       # 入口文件
│   └── env.d.ts      # 类型声明文件
├── public/           # 静态资源目录
├── index.html        # HTML 模板
├── package.json      # 项目配置文件
├── tsconfig.json     # TypeScript 配置
├── vite.config.ts    # Vite 配置
└── README.md         # 项目说明文档
```

## 三、主要功能

### 1. 国际化支持

- 使用 Vue I18n 实现多语言支持
- 支持中文和英文两种语言
- 语言切换功能，支持实时切换
- 语言包模块化管理

### 2. 主题系统

- 支持明暗主题切换
- 使用 Element Plus 的主题系统
- 响应式的主题切换效果
- 主题状态持久化

### 3. 布局系统

- 响应式的页面布局
- 固定的顶部导航栏
- 自适应的内容区域
- 统一的样式管理

### 4. 路由系统

- 基于 Vue Router 的路由管理
- 路由懒加载
- 404 页面处理
- 路由参数管理

### 5. 流式请求处理

- 在 `request.ts` 中实现了流式请求处理，使用 Fetch API 代替 Axios 处理流式响应。
- `generateChapter` 方法现在支持流式响应，允许前端实时接收生成的章节内容。

## 四、页面组件说明

### 1. 项目管理页面 (`/project`)

项目管理页面是应用的主要工作区域，提供项目的增删改查功能。

**功能特点：**

- 以卡片形式展示项目列表
- 支持创建新项目
- 支持编辑项目名称
- 支持删除项目
- 点击项目卡片可进入项目详情页面
- 响应式布局，自适应不同屏幕尺寸

**交互说明：**

- 项目卡片采用 hover 效果，鼠标悬停时显示阴影
- 编辑和删除按钮位于卡片底部
- 删除操作需要二次确认
- 新建项目通过模态框进行

### 2. 项目详情页面 (`/project/:name`)

项目详情页面，展示特定项目的详细信息，包含多个功能子页面。

**功能特点：**

- 显示项目名称
- 提供多个功能页面的导航：
  - 文本创作
  - 角色库
  - 分镜制作
  - 视频输出
- 使用侧边栏导航切换不同功能
- 使用路由嵌套展示子页面内容

### 3 角色库页面 (`/project/:name/character-library`)

角色库页面用于管理项目中的角色信息。

**功能特点：**

- 角色列表展示

  - 显示角色名称、角色职责和角色描述
  - 支持中英文切换
  - 提供操作栏进行角色管理

- 角色管理功能

  - 锁定/解锁角色：防止角色信息被自动更新
  - 反推提示词：根据角色描述生成提示词
  - 保存角色：保存角色的最新修改
  - 删除角色：从知识图谱中移除角色

- 操作栏布局

  - 采用两行布局设计
  - 第一行：锁定/解锁 + 反推提示词按钮
  - 第二行：保存 + 删除按钮
  - 统一的按钮样式和大小

### 4.场景库页面 (`/project/:name/scene-library`)

场景库页面用于管理项目中的场景信息。

**功能特点：**

- 列表展示

  - 显示名称、描述
  - 支持中英文切换
  - 提供操作栏进行管理

- 管理功能

  - 反推提示词：根据描述生成提示词
  - 保存：保存场景的最新修改
  - 删除：移除场景

### 5. 文本创作页面 (`/project/:name/text-creation`)

文本创作页面是项目的核心功能页面之一，用于管理和创作章节内容。

**功能特点：**

- 章节管理功能

  - 章节列表下拉菜单，显示所有章节
  - 新增章节按钮，自动创建新的章节文件夹和 content.txt 文件
  - 分割章节按钮，可以将当前章节内容分割成多个子章节

- 创作功能

  - 创作/续写模式切换
  - 使用上一章节内容选项
  - 保存章节内容
  - AI 辅助创作/续写功能，支持实时流式输出
  - 使用 ReadableStream 和 TextDecoder 处理流式响应

- 布局优化

  - 合理的按钮布局：分割章节按钮在左侧，保存和创作按钮在右侧
  - 响应式的文本编辑区域
  - 清晰的操作反馈和错误提示

### 6. 分镜流程页面 (`views/ProjectMain/StoryboardProcess/index.vue`)

**功能特点：**

- 场景管理功能
  - 显示场景列表，包括序号、分割片段、场景描述和提示词
  - 支持编辑分割片段、场景描述和提示词
  - 场景内容修改后自动标记为已修改状态
  - 图片预览功能，支持点击放大查看
- 批量操作功能
  - 支持批量转换场景描述为提示词
  - 支持批量生成图片和音频，并显示生成进度
  - 支持一键保存所有修改的场景
- 生成进度显示
  - 在批量生成图片/音频时显示进度条
  - 显示当前生成进度和总数
  - 支持错误信息显示
- 国际化支持
  - 支持中英文切换
  - 所有文本和提示信息均支持国际化

**主要组件：**

- `Scene` 接口：定义场景数据结构，包含序号、分割片段、场景描述、提示词等字段
- 场景列表表格：使用 Element Plus 的 Table 组件，支持编辑和状态显示
- 批量操作按钮组：提供批量转换、生成和保存功能
- 进度显示组件：使用 Element Plus 的 Progress 组件显示生成进度

### 7. 视频输出页面 (`/project/:name/video-output`)

视频输出页面用于管理项目中的视频输出。

**功能特点：**

- 视频列表展示

  - 显示视频名称、视频描述和视频状态
  - 支持中英文切换
  - 提供操作栏进行视频管理

- 视频管理功能

  - 下载视频：下载视频文件
  - 删除视频：从项目中移除视频
  - 编辑视频：编辑视频名称和描述

- 操作栏布局

  - 采用两行布局设计
  - 第一行：下载 + 删除按钮
  - 第二行：编辑按钮
  - 统一的按钮样式和大小

### 8. 404 页面 (`/:pathMatch(.*)`)

**功能特点：**

- 友好的错误提示
- 提供返回首页的链接
- 支持多语言显示
- 自适应主题样式

### 9. 设置页面 (`/setting`)

设置页面提供了应用程序的全局配置管理功能。

**功能特点：**

1. **界面设计**

   - 使用 Element Plus 的卡片组件展示设置内容
   - 清晰的分组布局，包括 ComfyUI、默认工作流、LLM 和路径配置等部分
   - 响应式设计，适配不同屏幕尺寸
   - 支持明暗主题切换，使用 Element Plus 的主题变量系统

2. **配置管理**

   - ComfyUI 配置：设置 API URL
   - 默认工作流配置：从可用工作流列表中选择默认工作流
   - LLM 配置：设置 API URL、模型名称和窗口大小
   - 路径配置：管理项目、提示词和工作流的相对路径

3. **交互优化**

   - 所有输入框支持一键清空
   - 输入框添加图标前缀，提升可识别性
   - 保存按钮包含图标，提供加载状态反馈
   - 操作结果使用 Element Plus 的消息提示

4. **样式特点**

   - 设置区域使用卡片式布局
   - 每个配置部分使用独立的背景色和边框
   - 鼠标悬停时提供交互反馈
   - 支持深色模式，自动适配主题切换

5. **国际化支持**

   - 所有文本支持中英文切换
   - 错误提示信息国际化
   - 占位符文本双语支持

**交互流程：**

1. **配置加载**

   - 页面加载时自动获取当前配置
   - 显示加载状态指示器
   - 加载失败时显示错误提示

2. **配置保存**

   - 点击保存按钮触发配置更新
   - 显示保存中状态
   - 保存成功或失败时显示对应提示
   - 保存完成后自动刷新配置

3. **错误处理**

   - 加载配置失败时显示友好提示
   - 保存配置失败时提供错误信息
   - 支持重试操作

### 10. 分镜流程管理页面 (`/project/:name/storyboard`)

分镜流程管理页面提供了场景的管理和生成功能。

#### 功能特点

1. **场景管理**

   - 场景列表展示，包括场景描述、提示词和生成的图片
   - 支持多选功能，可以批量选择场景进行操作
   - 支持场景描述的编辑和保存
   - 支持将场景描述转换为图像生成提示词
   - 分页显示场景列表，保持选中状态

2. **图像生成**

   - 支持单个场景和选中场景的图像生成
   - 实时显示生成进度，包括当前进度和总进度
   - 支持取消正在进行的生成任务
   - 生成完成后自动显示生成的图片
   - 生成失败时显示详细的错误信息

3. **音频生成**

   - 支持为每个场景生成对应的音频
   - 支持批量生成选中场景的音频
   - 音频生成进度显示和状态管理
   - 支持设置语音和语速参数
   - 生成完成后自动显示音频播放器

4. **进度管理**

   - 进度条显示当前生成进度
   - 支持生成中断功能
   - 进度条状态包括：运行中、完成、错误
   - 生成完成时显示平滑的进度动画

5. **图像设置**

   - 支持设置图像宽度和高度
   - 支持选择图像生成风格
   - 所有设置实时生效

#### 交互流程

1. **场景选择**

   - 支持单选和多选场景
   - 选中状态在翻页后保持
   - 提供全选/取消全选功能
   - 显示当前选中的场景数量

2. **单个图像/音频生成**

   - 点击场景的"生成图片"或"生成音频"按钮
   - 显示进度条和取消按钮
   - 生成完成后自动显示结果
   - 支持随时取消生成

3. **批量生成**

   - 选择需要处理的场景
   - 点击"生成选中图片"或"生成选中音频"按钮
   - 显示总体进度
   - 生成完成后自动更新所有结果
   - 支持随时取消生成

4. **错误处理**

   - 显示详细的错误信息
   - 支持重试生成
   - 取消时自动清理状态
